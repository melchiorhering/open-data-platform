## Prefect Server Overrides for Local Setup

## ‚ö†Ô∏è STORAGE SETUP: Reverting to simple local SQLite + Redis
postgresql:
  enabled: false
sqlite:
  enabled: true
  persistence:
    enabled: true
    size: 1Gi
redis:
  enabled: true
  architecture: standalone

## SERVER CONFIGURATION
server:
  # Enable Basic Auth (as defined in your previous configuration)
  basicAuth:
    enabled: true
    authString: "admin:pass"

  uiConfig:
    # üöÄ EXTERNAL ACCESS URL: Prefect must know its external address for the UI to function correctly.
    # We use HTTPS because the traffic hits our patched Gateway on host port 443.
    prefectUiApiUrl: "https://prefect.127.0.0.1.sslip.io"

  # Resource requests for the server pod
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: "1"
      memory: 1Gi

# HTTPRoute configuration tells the Gateway where traffic for 'prefect.127.0.0.1.sslip.io' should go.
httproute:
  # Enable the HTTPRoute manifest generation
  enabled: true

  # Hostnames this HTTPRoute will match (MUST match the certificate)
  hostnames:
    - "prefect.127.0.0.1.sslip.io"

  # CRITICAL: Attach this HTTPRoute to the existing, manually managed Gateway
  parentRefs:
    - name: kind-gateway # Name of the existing Gateway created by the cluster.config.sh script
      namespace: default # Namespace where kind-gateway lives
      sectionName: https # Attach to the HTTPS listener on the Gateway
      # port: 443               # (Optional: sectionName=https implies 443)

  # Redirect all HTTP traffic to HTTPS for security
  tls:
    redirect: true
    redirectPort: 443 # Redirect to the standard HTTPS port
